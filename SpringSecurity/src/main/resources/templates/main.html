<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="/styles.css">
    <link rel="stylesheet" type="text/css" href="/menuStyles.css">
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <title>메인화면</title>
</head>
<body>
<div id="login-items">
    <button onclick="join()" id="joinBtn">회원가입</button>
    <button onclick="login()" id="loginBtn">로그인</button>
<!--    <form action="/logout" method="get">-->
<!--        <input type="submit" id="logout" value="로그아웃">-->
<!--    </form>-->
</div>
<h1 id="logo"><a id="home_like" href="/">동아리 관리 시스템</a></h1>
<nav id="main-nav">
    <div id="menu-items">
        <button onclick="boardPagingReq()" id="boardPagingBtn">자유게시판</button>
        <button onclick="rentReq()" id="rentBtn">대여 시스템</button>
        <button onclick="todoReq()" id="todoBtn">일정 관리</button>
        <button onclick="scoreReq()" id="scoreBtn">동아리 평가</button>
        <button onclick="clubReq()" id="clubBtn">동아리 목록</button>
        <button onclick="clubMemberBtn()" id="clubMemberBtn">부원 관리</button>
        <button onclick="clubFeeBtn()" id="clubFeeBtn">회비 내역</button>
        <button onclick="anqReq()" id="qnaBtn">Q&A</button>
    </div>
</nav>

<!-------------------------------------------------------------------------------------------------------------------->
<div id="main-container" th:if="${not #strings.equals(id, 'anonymousUser')}">
    <div id="left-container">
        <div class="login-box">
            <div id="login-info">
                <div id="img-box">
                    <img src="/default.png" alt="My Image" id="my-photo">
                </div>

                <div class="my-info">
                    <span class="right-border">동아리 </span><span th:text="' '+${clubDTO.clubName}"></span><br>
                    <span th:text="${id}+'님'"></span><br>
                    <span th:text="${clubDTO.clubRoom}+'호'"></span>
                </div>
                <div class="my-info">
                    <form action="/logout" method="get">
                        <input type="submit" id="logout" value="로그아웃">
                    </form>
                </div>

            </div>
        </div>

        <div class="favorite-box">
            <div class="favorite-item">
                <h2>즐겨찾기</h2>
                <table>
                    <tr th:each="favoriteBoardDTO : ${favoriteBoardDTOList}">
                        <td>•</td>
                        <td><a th:href="@{|/board/${favoriteBoardDTO.boardId}|}"
                               th:text="${favoriteBoardDTO.boardTitle}"></a></td>
                        <td th:text="${favoriteBoardDTO.boardWriter}+'님'"></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="heart-box">
            <div class="heart-item">
                <h2>"좋아요" 목록</h2>
                <table th:if="${heartBoardList != null}">
                    <tr th:each="heartBoard : ${heartBoardList}">
                        <td>•</td>
                        <td><a th:href="@{|/board/${heartBoard.id}|}" th:text="${heartBoard.boardTitle}"></a></td>
                        <td th:text="${heartBoard.boardWriter}+'님'"></td>
                        <td><a th:href="@{|/heart/${heartBoard.id}/${id}|}">❤️</a></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>


    <div id="right-container">

        <div id="right-top-container">
            <div class="admin-box">
                <div id="admin-chairman-items">
                    <h2>동연회 임원</h2>
                </div>
            </div>

            <div class="admin-box">
                <div id="receive-todo-list">
                    <div id="receive-todo-items" th:if="${not #strings.equals(id, 'anonymousUser')}">
                        <h2>동연회 요청</h2>
                        <span th:if="${receiveTodoList == null}">등록된 요청이 없습니다.</span>
                        <table th:if="${receiveTodoList != null}" class="todo-table">
                            <tr th:each="todo: ${receiveTodoList}">
                                <td>•</td>
                                <td><a th:href="@{|/todo/receivedTodo/${clubId}/${todo.id}|}"
                                       th:text="${todo.title}"></a></td>
                                <td th:text="*{#temporals.format(todo.endTime, 'yy.MM.dd   HH:mm')}"></td>
                                <td th:text="*{#temporals.format(todo.endTime, 'yy.MM.dd   HH:mm')}"></td>
                            </tr>
                        </table>
                    </div>

                </div>
            </div>

            <div class="admin-box">
                <h2>공지사항</h2>
                <span th:if="${noticeList == null}">등록된 공지가 없습니다.</span>
                <table th:if="${noticeList != null}" class="todo-table">
                    <tr th:each="notice: ${noticeList}">
                        <td>•</td>
                        <td><a th:href="@{|/board/${notice.id}|}"
                               th:text="${notice.boardTitle}"></a></td>
                        <td th:text="*{#temporals.format(notice.boardCreatedTime, 'yy.MM.dd')}"></td>
                    </tr>
                </table>
            </div>
        </div>


        <div id="right-middle-container">
            <div class="todo-box">
                <div id="my-todo-list">
                    <div id="my-todo-items" th:if="${not #strings.equals(id, 'anonymousUser')}">
                        <h2>나의 일정</h2>
                        <span th:if="${myTodoList == null}">등록된 일정이 없습니다.</span>
                        <table th:if="${myTodoList != null}" class="todo-table">
                            <tr th:each="todo: ${myTodoList}">
                                <td>•</td>
                                <td><a th:href="@{|/todo/myTodoList/${clubId}/${todo.id}|}"
                                       th:text="${todo.title}"></a>
                                </td>
                                <td th:text="*{#temporals.format(todo.startTime, 'MM.dd')}"></td>
                                <td th:text="*{#temporals.format(todo.endTime, 'yy.MM.dd   HH:mm')}"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="clubInfo-box">
                <div id="clubMember-list">
                    <div id="clubMember-items" th:if="${not #strings.equals(id, 'anonymousUser')}">
                        <h2>동아리 임원</h2>
                        <table th:if="${chairManList != null}" class="todo-table">
                            <tr th:each="chairMan: ${chairManList}">
                                <td>•</td>
                                <td th:text="${chairMan.detailPosition}"></td>
                                <td th:text="${chairMan.realName}"></td>
                                <td th:text="${chairMan.phoneNumber}"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="clubInfo-box">
                <div id="clubMoney-list">
                    <div id="clubMoney-items" th:if="${not #strings.equals(id, 'anonymousUser')}">
                        <h2>동아리 회비</h2>
                        <div class="zt-skill-bar">
                            <div th:data-width="${feePercent}" th:text="${feePercent}+'%'"></div>
                        </div>
                        <span th:text="'총 입금액 : '+${totalDepositAmount}+'원'"></span><br>
                        <span th:text="'총 사용액 : '+${totalSpentAmount}+'원'"></span>
                    </div>
                </div>
            </div>
        </div>


        <div id="right-bottom-container">
            <div class="achievement-box">
                <h2>지원금 기준 달성도</h2>
                <div class="round-graph chart1"><span class="center" th:text="${percentScore} + '%'"></span></div>
                <div th:text="'현재 점수 : '+${clubScore}+'점'"></div>
            </div>

            <div class="QnA-box">
                <h2>나의 Q&A</h2>
                <table th:if="${myQnaList != null}" class="todo-table">
                    <tr th:each="qnaDTO: ${myQnaList}">
                        <td>•</td>
                        <td><a th:href="@{|/qna/${qnaDTO.id}|}" th:text="${qnaDTO.boardTitle}"></a></td>
                        <td>답변여부(미완성)</td>
                    </tr>
                </table>
            </div>

            <div class="some-box">
                <h2>대여 물품</h2>
                <table th:if="${myRentalList != null}" class="todo-table">
                    <tr th:each="rentalDTO: ${myRentalList}">
                        <td>•</td>
                        <td th:text="${rentalDTO.name}"></td>
                        <td th:text="${rentalDTO.location}"></td>
                    </tr>
                </table>
            </div>

        </div>
    </div>
</div>
</body>

<script th:inline="javascript">

    const id = [[${id}]];

    const join = () => {
        location.href="/join";
    }

    const login = () => {
        location.href="/login";
    }

    const clubFeeBtn = () => {
        location.href="/clubFee/";
    }

    const boardPagingReq = () => {
        location.href="/board/paging";
    }

    const anqReq = () => {
        location.href="/qna/paging";
    }


    const rentReq = () => {
        location.href="/rental/"
    }

    const clubReq = () => {
        location.href="/club/"
    }

    const todoReq = () => {
        if (id.startsWith('admin')) {
            location.href="/todo/admin";
        } else {
            location.href="/todo/user";
        }
    }

    const clubMemberBtn = () => {
        location.href="/clubMember/"
    }


    const scoreReq = () => {
        location.href="/score/";
    }

    const chart1 = document.querySelector('.chart1');
    const clubScore = [[${clubScore}]];

    const makeChart = (percent,classname,color) => {
        let i=1;
        let chartFn = setInterval(function () {
            if (i <= percent) {
                colorFn(i,classname,color);
                i++;
            } else {
                clearInterval(chartFn);
            }
        },10);
    }

    const colorFn = (i, classname, color) => {
        classname.style.background = "conic-gradient(" + color + " 0% " + i + "%, transparent " + i + "% 10%, #dedede 50% 100%)";
    }

    makeChart(clubScore, chart1, '#374864');


    document.addEventListener('DOMContentLoaded', function () {
        function animatedContents() {
            var skillBars = document.querySelectorAll('.zt-skill-bar > div');

            skillBars.forEach(function (bar) {
                var skills = bar.dataset.width;
                bar.style.width = skills + '%';
            });
        }

        var skillBars = document.querySelectorAll('.zt-skill-bar');

        if ('IntersectionObserver' in window) {
            var observer = new IntersectionObserver(function (entries) {
                entries.forEach(function (entry) {
                    if (entry.isIntersecting) {
                        animatedContents();
                    }
                });
            });

            skillBars.forEach(function (bar) {
                observer.observe(bar);
            });
        } else {
            animatedContents();
        }
    });


    const favoriteReq = () => {
        location.href="/favorite/list"
    }

</script>
</html>
