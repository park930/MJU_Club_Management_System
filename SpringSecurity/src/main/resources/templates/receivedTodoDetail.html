<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>detail</title>
    <!-- jquery cdn -->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
</head>
<body>

<div th:if="${scoreDTO != null}" id="score-info">
    <h2>동아리평가 항목입니다.</h2>
    <table>
        <thead>
        <tr>
            <th>정상제출</th>
            <th>지각제출</th>
            <th>미제출</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${scoreDTO.normalSubmit}">점</td>
            <td th:text="${scoreDTO.lateSubmit}">점</td>
            <td th:text="${scoreDTO.noSubmit}">점</td>
        </tr>
        </tbody>
    </table>

    <table>
        <thead>
        <tr>
            <th>1등</th>
            <th>2등</th>
            <th>3등</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${scoreDTO.plusRank1}">점</td>
            <td th:text="${scoreDTO.plusRank2}">점</td>
            <td th:text="${scoreDTO.plusRank3}">점</td>
        </tr>
        </tbody>
    </table>
</div>


<div id="todo-info">
    <hr>
    <table>
        <tr>
            <th>id</th>
            <td th:text="${todo.id}"></td>
        </tr>
        <tr>
            <th>title</th>
            <td th:text="${todo.title}"></td>
        </tr>
        <tr>
            <th>writer</th>
            <td th:text="${todo.content}"></td>
        </tr>
        <tr>
            <th>시작일</th>
            <td th:text="*{#temporals.format(todo.startTime, 'yy.MM.dd   HH:mm')}"></td>
        </tr>
        <tr>
            <th>마감일</th>
            <td th:text="*{#temporals.format(todo.endTime, 'yy.MM.dd   HH:mm')}"></td>
        </tr>
    </table>
</div>

<hr>

<div id="comment-write">
    <input type="text" id="clubId" th:value="${clubId}" hidden>
    <input type="radio" name="type" id="resultRadio"> 결과물
    <input type="radio" name="type" id="questionRadio" checked> 질문<br>
    <textarea id="content" placeholder="내용"></textarea>
    <button id="comment-write-btn" onclick="commentWrite()">댓글작성</button>
</div>
<br>
<!-- 댓글 출력 부분 -->
<div id="comment-list">
    <table>
        <tr>
            <th>id</th>
            <th>유형</th>
            <th>내용</th>
            <th>작성시간</th>
        </tr>
        <tr th:each="comment: ${commentList}">
            <td th:text="${comment.id}"></td>
            <td th:text="${comment.type}"></td>
            <td th:text="${comment.content}"></td>
            <td th:text="${comment.createdTime}"></td>
        </tr>
    </table>
</div>

</body>

<script th:inline="javascript">

    const commentWrite = () => {
        const writer = document.getElementById("clubId").value;
        const resultRadio = document.getElementById("resultRadio");
        const content = document.getElementById("content").value;
        const todoId = [[${todo.id}]];

        let isSubmit;
        let type;

        if (resultRadio && resultRadio.checked) {
            type = "result";
            isSubmit = 1;
        } else {
            type = "question";
            isSubmit = 0;
        }

        console.log("제출 여부",isSubmit)


        $.ajax({
            // 요청방식: post, 요청주소: /comment/save, 요청데이터: 작성자, 작성내용, 게시글번호
            type: "post",
            url: "/receivedTodoComment/save",
            data: {
                "clubId": writer,
                "todoId": todoId,
                "type": type,
                "content" : content,
                "resultSubmit" : isSubmit
            },
            success: function (res) {
                console.log("요청성공", res);
                let output = "<table>";
                output += "<tr><th>id</th>";
                output += "<th>유형</th>";
                output += "<th>내용</th>";
                output += "<th>작성시간</th></tr>";
                for (let i in res) {
                    output += "<tr>";
                    output += "<td>" + res[i].id + "</td>";
                    output += "<td>" + res[i].type + "</td>";
                    output += "<td>" + res[i].content + "</td>";
                    output += "<td>" + res[i].createdTime + "</td>";
                    output += "</tr>";
                }
                output += "</table>";
                document.getElementById('comment-list').innerHTML = output;
                document.getElementById('content').value = '';
            },
            error: function (err) {
                console.log("요청실패", err);
            }
        });

    }


</script>

</html>